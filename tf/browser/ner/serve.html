<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.11.1" />
<title>tf.browser.ner.serve API documentation</title>
<meta name="description" content="Main controller for Flask â€¦" />
<!-- integrity SRI from https://cdnjs.com/libraries/10up-sanitize.css/11.0.1 -->
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css"
integrity="sha512-kcbluZFacWN57NgWZ4aH6eUMBEaTyErFhIFD3y5qYZbKuuyImH0K/AKsBbfXlivh2z5C+3IDTIhI11YmKomzmA=="
crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css"
integrity="sha512-uVeAgzAmieLUTGba0qr9vXQgVD7fko2kcbYIKIraXUIDg9iJLxveTFUrg3DJhqn3cAf3HFDbgmhq0eGko5wEAA=="
crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>tf.browser.ner.serve</code></h1>
</header>
<section id="section-intro">
<p>Main controller for Flask</p>
<p>This module contains the controllers that Flask invokes when serving
the annotation tool in the TF browser.</p>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/annotation/text-fabric/blob/9eca24336097ff19bbabbb452d43c1706049ba50/tf/browser/ner/serve.py#L1-L365" class="git-link">Browse git</a>
</summary>
<pre><code class="python">&#34;&#34;&#34;Main controller for Flask

This module contains the controllers that Flask invokes when serving
the annotation tool in the TF browser.
&#34;&#34;&#34;

from flask import render_template

from ...ner.settings import TOOLKEY

from .websettings import SC_ALL
from .request import Request
from .fragments import Fragments


class Serve(Request, Fragments):
    def __init__(self, web):
        &#34;&#34;&#34;Object that implements the controller functions for the annotation tool.

        Parameters
        ----------
        web: object
            This represents the Flask website that is the TF browser.
            It has initialized a `tf.ner.ner.NER` object,
            and has stored it under attribute `ner`.
            See `tf.browser.ner.web.factory` and `tf.browser.web.factory`.

        &#34;&#34;&#34;
        self.web = web

        ner = web.ner
        self.ner = ner

        Request.__init__(self)

        self.initVars()

    def setupFull(self):
        &#34;&#34;&#34;Prepares to serve a complete page.

        *   Sets up the find widget;
        *   Encodes the active entity in hidden `input` elements;
        *   Collects and generates the specific CSS styles needed for this corpus.
        &#34;&#34;&#34;
        ner = self.ner
        v = self.v

        self.findSetup()
        self.wrapActive()

        v.css = ner.css

    def setupLean(self):
        &#34;&#34;&#34;Prepares to update a portion of the page.

        *   Encodes the active entity in hidden `input` elements.
        &#34;&#34;&#34;
        self.wrapActive()

    def actionsFull(self):
        &#34;&#34;&#34;Carries out requested actions before building the full page.

        *   annotation set management actions;
        *   fetch selected buckets from the whole corpus;
        *   modification actions in the selected set.
        &#34;&#34;&#34;
        self.setHandling()
        self.getBuckets()
        self.updateHandling()

    def actionsLean(self, node):
        &#34;&#34;&#34;Carries out requested actions before building a portion of the page.

        *   fetch all buckets from a section of the corpus.
        &#34;&#34;&#34;
        self.getBuckets(node=node)

    def wrapFull(self):
        &#34;&#34;&#34;Builds the full page.

        This includes the controls by which the user makes selections and triggers
        actions.
        &#34;&#34;&#34;
        ner = self.ner
        v = self.v
        sortKey = v.sortkey
        sortDir = v.sortdir
        subtleFilter = v.subtlefilter
        activeEntity = v.activeentity
        activeTrigger = v.activetrigger
        tokenStart = v.tokenstart
        tokenEnd = v.tokenend
        excludedTokens = v.excludedtokens

        buckets = self.buckets

        self.wrapQuery()
        v.entitytable = (
            ner.showEntities(
                activeEntity=activeEntity, sortKey=sortKey, sortDir=sortDir
            )
            if ner.sheetName is None
            else ner.showTriggers(
                activeEntity=activeEntity,
                activeTrigger=activeTrigger,
                sortKey=sortKey,
                sortDir=sortDir,
                subtleFilter=subtleFilter,
            )
        )
        v.entityoverview = ner.showEntityOverview()
        v.entityheaders = self.wrapEntityHeaders()
        v.buckets = ner.showContent(
            buckets,
            activeEntity=activeEntity,
            activeTrigger=activeTrigger,
            excludedTokens=excludedTokens,
            mayLimit=not (tokenStart and tokenEnd),
        )

        return render_template(f&#34;{TOOLKEY}/index.html&#34;, **v)

    def wrapLean(self):
        &#34;&#34;&#34;Builds a portion of the page.

        No need to build user controls, because they are already on the page.

        Returns
        -------
        The generated HTML for the portion of the page.
        &#34;&#34;&#34;
        ner = self.ner
        v = self.v
        activeEntity = v.activeentity
        activeTrigger = v.activetrigger
        excludedTokens = v.excludedtokens
        buckets = self.buckets

        return ner.showContent(
            buckets,
            activeEntity=activeEntity,
            activeTrigger=activeTrigger,
            excludedTokens=excludedTokens,
            mayLimit=False,
        )

    def getBuckets(self, noFind=False, node=None):
        &#34;&#34;&#34;Fetch a selection of buckets from the corpus.

        The selection is defined in the `v`.

        We further modify the selection by two additional parameters.

        The resulting list of buckets is obtained by
        `tf.ner.ner.NER.filterContent`, and each member in the bucket
        list is a tuple as indicated in the `filterContent` function.
        The list is stored in the `Serve` object.
        Additionally, statistics about these buckets and how many entity values
        occur in it, are delivered in the `v`.

        Parameters
        ----------
        noFind: boolean, optional False
            If `noFind` we override the filtering by the filter widget on the interface.

            We use this when the user has indicated that he wants to apply an action
            on all buckets instead of the filtered ones.

        node: integer, optional None
            If passed, it is a TF node, probably for a top-level section.
            The effect is that it restricts the result to those buttons that fall
            under that TF node.

            We use this when we retrieve the context for a given bucket.
        &#34;&#34;&#34;
        ner = self.ner
        v = self.v

        bFindRe = None if noFind else v.bfindre
        anyEnt = v.anyent
        activeEntity = v.activeentity
        activeTrigger = v.activetrigger
        tokenStart = v.tokenstart
        tokenEnd = v.tokenend
        valSelect = v.valselect
        freeState = v.freestate

        setData = ner.getSetData()
        entityIdent = setData.entityIdent

        if activeEntity not in entityIdent:
            activeEntity = None
            v.activeentity = None
            v.activetrigger = None

        if activeTrigger is None:
            activeTrigger = None
            v.activetrigger = None

        qTokens = (
            ner.getStrings(tokenStart, tokenEnd) if tokenStart and tokenEnd else None
        )

        (
            self.buckets,
            v.nfind,
            v.nvisible,
            v.nent,
        ) = ner.filterContent(
            node=node,
            bFindRe=bFindRe,
            anyEnt=anyEnt,
            eVals=activeEntity,
            trigger=activeTrigger,
            qTokens=qTokens,
            valSelect=valSelect,
            freeState=freeState,
        )

    def setHandling(self):
        &#34;&#34;&#34;Carries out the set-related actions before composing the page.

        These actions are:

        *   read the list of sets again
        *   switch to an other set than the current set
            and create it if it does not yet exist;
        *   duplicate the current set;
        *   rename the current set;
        *   delete a set.

        The results of the actions are wrapped in messages and stored in the
        `v`.
        &#34;&#34;&#34;
        ner = self.ner
        ner.readSets()
        ner.readSheets()

        v = self.v
        chosenTask = v.task
        dupSet = v.duset
        renamedSet = v.rset
        deleteSet = v.dset

        messages = []

        if deleteSet:
            messages.extend(ner.setDel(deleteSet))
            v.dset = &#34;&#34;
            v.task = &#34;&#34;

        if dupSet:
            messages.extend(ner.setDup(dupSet))
            v.task = dupSet
            v.duset = &#34;&#34;

        if renamedSet and chosenTask:
            messages.extend(ner.setMove(renamedSet))
            v.task = renamedSet
            v.rset = &#34;&#34;

        v.messagesrc = messages

        chosenTask = v.task
        sheetCase = v.sheetcase
        ner.setTask(chosenTask, caseSensitive=sheetCase)
        ner.loadSetData()

        self.wrapSets()
        self.wrapMessages()
        self.wrapCaption()
        self.wrapLogs()

    def updateHandling(self):
        &#34;&#34;&#34;Carries out modification actions in the current annotation set.

        Modification actions are:

        *   deletion of an entity;
        *   addition of an entity.

        The results of the actions are wrapped in a report and stored in the
        `v`.
        &#34;&#34;&#34;
        ner = self.ner
        v = self.v

        delData = v.deldata
        addData = v.adddata
        activeEntity = v.activeentity
        tokenStart = v.tokenstart
        tokenEnd = v.tokenend
        submitter = v.submitter
        excludedTokens = v.excludedtokens
        bFindRe = v.bfindre
        scope = v.scope

        hasEnt = activeEntity is not None
        hasOcc = tokenStart is not None and tokenEnd is not None

        if (
            submitter in {&#34;delgo&#34;, &#34;addgo&#34;}
            and (delData or addData)
            and (hasEnt or hasOcc)
        ):
            if bFindRe and scope == SC_ALL:
                self.getBuckets(noFind=True)

            if submitter == &#34;delgo&#34; and delData:
                report = ner.delEntityRich(
                    delData.deletions, self.buckets, excludedTokens=excludedTokens
                )
                ner.loadSetData()
                self.wrapReport(report, &#34;del&#34;)
                if hasEnt:
                    setData = ner.getSetData()
                    entityIdent = setData.entityIdent

                    stillExists = activeEntity in entityIdent
                    if not stillExists:
                        v.activeentity = None
                        v.activetrigger = None

            if submitter == &#34;addgo&#34; and addData:
                report = ner.addEntityRich(
                    addData.additions, self.buckets, excludedTokens=excludedTokens
                )
                ner.loadSetData()
                self.wrapReport(report, &#34;add&#34;)

            self.adaptValSelect()

            self.getBuckets()


def serveNer(web):
    &#34;&#34;&#34;Main controller to render a full page.

    Parameters
    ----------
    web: object
        The TF browser object, a Flask web app.
    &#34;&#34;&#34;
    serve = Serve(web)
    serve.setupFull()
    serve.actionsFull()
    return serve.wrapFull()


def serveNerContext(web, node):
    &#34;&#34;&#34;Controller to render a portion of a page.

    More specifically: the context around a single bucket.

    Parameters
    ----------
    web: object
        The TF browser object, a Flask web app.
    node: integer
        The TF node that contain the bucket nodes that form the context.
    &#34;&#34;&#34;
    serve = Serve(web)
    serve.setupLean()
    serve.actionsLean(node)
    return serve.wrapLean()</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="tf.browser.ner.serve.serveNer"><code class="name flex">
<span>def <span class="ident">serveNer</span></span>(<span>web)</span>
</code></dt>
<dd>
<div class="desc"><p>Main controller to render a full page.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>web</code></strong> :&ensp;<code>object</code></dt>
<dd>The TF browser object, a Flask web app.</dd>
</dl></div>
</dd>
<dt id="tf.browser.ner.serve.serveNerContext"><code class="name flex">
<span>def <span class="ident">serveNerContext</span></span>(<span>web, node)</span>
</code></dt>
<dd>
<div class="desc"><p>Controller to render a portion of a page.</p>
<p>More specifically: the context around a single bucket.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>web</code></strong> :&ensp;<code>object</code></dt>
<dd>The TF browser object, a Flask web app.</dd>
<dt><strong><code>node</code></strong> :&ensp;<code>integer</code></dt>
<dd>The TF node that contain the bucket nodes that form the context.</dd>
</dl></div>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="tf.browser.ner.serve.Serve"><code class="flex name class">
<span>class <span class="ident">Serve</span></span>
<span>(</span><span>web)</span>
</code></dt>
<dd>
<div class="desc"><p>Object that implements the controller functions for the annotation tool.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>web</code></strong> :&ensp;<code>object</code></dt>
<dd>This represents the Flask website that is the TF browser.
It has initialized a <code><a title="tf.ner.ner.NER" href="../../ner/ner.html#tf.ner.ner.NER">NER</a></code> object,
and has stored it under attribute <code>ner</code>.
See <code><a title="tf.browser.ner.web.factory" href="web.html#tf.browser.ner.web.factory">factory()</a></code> and <code><a title="tf.browser.web.factory" href="../web.html#tf.browser.web.factory">factory()</a></code>.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/annotation/text-fabric/blob/9eca24336097ff19bbabbb452d43c1706049ba50/tf/browser/ner/serve.py#L16-L333" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class Serve(Request, Fragments):
    def __init__(self, web):
        &#34;&#34;&#34;Object that implements the controller functions for the annotation tool.

        Parameters
        ----------
        web: object
            This represents the Flask website that is the TF browser.
            It has initialized a `tf.ner.ner.NER` object,
            and has stored it under attribute `ner`.
            See `tf.browser.ner.web.factory` and `tf.browser.web.factory`.

        &#34;&#34;&#34;
        self.web = web

        ner = web.ner
        self.ner = ner

        Request.__init__(self)

        self.initVars()

    def setupFull(self):
        &#34;&#34;&#34;Prepares to serve a complete page.

        *   Sets up the find widget;
        *   Encodes the active entity in hidden `input` elements;
        *   Collects and generates the specific CSS styles needed for this corpus.
        &#34;&#34;&#34;
        ner = self.ner
        v = self.v

        self.findSetup()
        self.wrapActive()

        v.css = ner.css

    def setupLean(self):
        &#34;&#34;&#34;Prepares to update a portion of the page.

        *   Encodes the active entity in hidden `input` elements.
        &#34;&#34;&#34;
        self.wrapActive()

    def actionsFull(self):
        &#34;&#34;&#34;Carries out requested actions before building the full page.

        *   annotation set management actions;
        *   fetch selected buckets from the whole corpus;
        *   modification actions in the selected set.
        &#34;&#34;&#34;
        self.setHandling()
        self.getBuckets()
        self.updateHandling()

    def actionsLean(self, node):
        &#34;&#34;&#34;Carries out requested actions before building a portion of the page.

        *   fetch all buckets from a section of the corpus.
        &#34;&#34;&#34;
        self.getBuckets(node=node)

    def wrapFull(self):
        &#34;&#34;&#34;Builds the full page.

        This includes the controls by which the user makes selections and triggers
        actions.
        &#34;&#34;&#34;
        ner = self.ner
        v = self.v
        sortKey = v.sortkey
        sortDir = v.sortdir
        subtleFilter = v.subtlefilter
        activeEntity = v.activeentity
        activeTrigger = v.activetrigger
        tokenStart = v.tokenstart
        tokenEnd = v.tokenend
        excludedTokens = v.excludedtokens

        buckets = self.buckets

        self.wrapQuery()
        v.entitytable = (
            ner.showEntities(
                activeEntity=activeEntity, sortKey=sortKey, sortDir=sortDir
            )
            if ner.sheetName is None
            else ner.showTriggers(
                activeEntity=activeEntity,
                activeTrigger=activeTrigger,
                sortKey=sortKey,
                sortDir=sortDir,
                subtleFilter=subtleFilter,
            )
        )
        v.entityoverview = ner.showEntityOverview()
        v.entityheaders = self.wrapEntityHeaders()
        v.buckets = ner.showContent(
            buckets,
            activeEntity=activeEntity,
            activeTrigger=activeTrigger,
            excludedTokens=excludedTokens,
            mayLimit=not (tokenStart and tokenEnd),
        )

        return render_template(f&#34;{TOOLKEY}/index.html&#34;, **v)

    def wrapLean(self):
        &#34;&#34;&#34;Builds a portion of the page.

        No need to build user controls, because they are already on the page.

        Returns
        -------
        The generated HTML for the portion of the page.
        &#34;&#34;&#34;
        ner = self.ner
        v = self.v
        activeEntity = v.activeentity
        activeTrigger = v.activetrigger
        excludedTokens = v.excludedtokens
        buckets = self.buckets

        return ner.showContent(
            buckets,
            activeEntity=activeEntity,
            activeTrigger=activeTrigger,
            excludedTokens=excludedTokens,
            mayLimit=False,
        )

    def getBuckets(self, noFind=False, node=None):
        &#34;&#34;&#34;Fetch a selection of buckets from the corpus.

        The selection is defined in the `v`.

        We further modify the selection by two additional parameters.

        The resulting list of buckets is obtained by
        `tf.ner.ner.NER.filterContent`, and each member in the bucket
        list is a tuple as indicated in the `filterContent` function.
        The list is stored in the `Serve` object.
        Additionally, statistics about these buckets and how many entity values
        occur in it, are delivered in the `v`.

        Parameters
        ----------
        noFind: boolean, optional False
            If `noFind` we override the filtering by the filter widget on the interface.

            We use this when the user has indicated that he wants to apply an action
            on all buckets instead of the filtered ones.

        node: integer, optional None
            If passed, it is a TF node, probably for a top-level section.
            The effect is that it restricts the result to those buttons that fall
            under that TF node.

            We use this when we retrieve the context for a given bucket.
        &#34;&#34;&#34;
        ner = self.ner
        v = self.v

        bFindRe = None if noFind else v.bfindre
        anyEnt = v.anyent
        activeEntity = v.activeentity
        activeTrigger = v.activetrigger
        tokenStart = v.tokenstart
        tokenEnd = v.tokenend
        valSelect = v.valselect
        freeState = v.freestate

        setData = ner.getSetData()
        entityIdent = setData.entityIdent

        if activeEntity not in entityIdent:
            activeEntity = None
            v.activeentity = None
            v.activetrigger = None

        if activeTrigger is None:
            activeTrigger = None
            v.activetrigger = None

        qTokens = (
            ner.getStrings(tokenStart, tokenEnd) if tokenStart and tokenEnd else None
        )

        (
            self.buckets,
            v.nfind,
            v.nvisible,
            v.nent,
        ) = ner.filterContent(
            node=node,
            bFindRe=bFindRe,
            anyEnt=anyEnt,
            eVals=activeEntity,
            trigger=activeTrigger,
            qTokens=qTokens,
            valSelect=valSelect,
            freeState=freeState,
        )

    def setHandling(self):
        &#34;&#34;&#34;Carries out the set-related actions before composing the page.

        These actions are:

        *   read the list of sets again
        *   switch to an other set than the current set
            and create it if it does not yet exist;
        *   duplicate the current set;
        *   rename the current set;
        *   delete a set.

        The results of the actions are wrapped in messages and stored in the
        `v`.
        &#34;&#34;&#34;
        ner = self.ner
        ner.readSets()
        ner.readSheets()

        v = self.v
        chosenTask = v.task
        dupSet = v.duset
        renamedSet = v.rset
        deleteSet = v.dset

        messages = []

        if deleteSet:
            messages.extend(ner.setDel(deleteSet))
            v.dset = &#34;&#34;
            v.task = &#34;&#34;

        if dupSet:
            messages.extend(ner.setDup(dupSet))
            v.task = dupSet
            v.duset = &#34;&#34;

        if renamedSet and chosenTask:
            messages.extend(ner.setMove(renamedSet))
            v.task = renamedSet
            v.rset = &#34;&#34;

        v.messagesrc = messages

        chosenTask = v.task
        sheetCase = v.sheetcase
        ner.setTask(chosenTask, caseSensitive=sheetCase)
        ner.loadSetData()

        self.wrapSets()
        self.wrapMessages()
        self.wrapCaption()
        self.wrapLogs()

    def updateHandling(self):
        &#34;&#34;&#34;Carries out modification actions in the current annotation set.

        Modification actions are:

        *   deletion of an entity;
        *   addition of an entity.

        The results of the actions are wrapped in a report and stored in the
        `v`.
        &#34;&#34;&#34;
        ner = self.ner
        v = self.v

        delData = v.deldata
        addData = v.adddata
        activeEntity = v.activeentity
        tokenStart = v.tokenstart
        tokenEnd = v.tokenend
        submitter = v.submitter
        excludedTokens = v.excludedtokens
        bFindRe = v.bfindre
        scope = v.scope

        hasEnt = activeEntity is not None
        hasOcc = tokenStart is not None and tokenEnd is not None

        if (
            submitter in {&#34;delgo&#34;, &#34;addgo&#34;}
            and (delData or addData)
            and (hasEnt or hasOcc)
        ):
            if bFindRe and scope == SC_ALL:
                self.getBuckets(noFind=True)

            if submitter == &#34;delgo&#34; and delData:
                report = ner.delEntityRich(
                    delData.deletions, self.buckets, excludedTokens=excludedTokens
                )
                ner.loadSetData()
                self.wrapReport(report, &#34;del&#34;)
                if hasEnt:
                    setData = ner.getSetData()
                    entityIdent = setData.entityIdent

                    stillExists = activeEntity in entityIdent
                    if not stillExists:
                        v.activeentity = None
                        v.activetrigger = None

            if submitter == &#34;addgo&#34; and addData:
                report = ner.addEntityRich(
                    addData.additions, self.buckets, excludedTokens=excludedTokens
                )
                ner.loadSetData()
                self.wrapReport(report, &#34;add&#34;)

            self.adaptValSelect()

            self.getBuckets()</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="tf.browser.ner.request.Request" href="request.html#tf.browser.ner.request.Request">Request</a></li>
<li><a title="tf.browser.ner.form.Form" href="form.html#tf.browser.ner.form.Form">Form</a></li>
<li><a title="tf.browser.ner.fragments.Fragments" href="fragments.html#tf.browser.ner.fragments.Fragments">Fragments</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="tf.browser.ner.serve.Serve.actionsFull"><code class="name flex">
<span>def <span class="ident">actionsFull</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Carries out requested actions before building the full page.</p>
<ul>
<li>annotation set management actions;</li>
<li>fetch selected buckets from the whole corpus;</li>
<li>modification actions in the selected set.</li>
</ul></div>
</dd>
<dt id="tf.browser.ner.serve.Serve.actionsLean"><code class="name flex">
<span>def <span class="ident">actionsLean</span></span>(<span>self, node)</span>
</code></dt>
<dd>
<div class="desc"><p>Carries out requested actions before building a portion of the page.</p>
<ul>
<li>fetch all buckets from a section of the corpus.</li>
</ul></div>
</dd>
<dt id="tf.browser.ner.serve.Serve.getBuckets"><code class="name flex">
<span>def <span class="ident">getBuckets</span></span>(<span>self, noFind=False, node=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Fetch a selection of buckets from the corpus.</p>
<p>The selection is defined in the <code>v</code>.</p>
<p>We further modify the selection by two additional parameters.</p>
<p>The resulting list of buckets is obtained by
<code><a title="tf.ner.ner.NER.filterContent" href="../../ner/ner.html#tf.ner.ner.NER.filterContent">NER.filterContent()</a></code>, and each member in the bucket
list is a tuple as indicated in the <code>filterContent</code> function.
The list is stored in the <code><a title="tf.browser.ner.serve.Serve" href="#tf.browser.ner.serve.Serve">Serve</a></code> object.
Additionally, statistics about these buckets and how many entity values
occur in it, are delivered in the <code>v</code>.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>noFind</code></strong> :&ensp;<code>boolean</code>, optional <code>False</code></dt>
<dd>
<p>If <code>noFind</code> we override the filtering by the filter widget on the interface.</p>
<p>We use this when the user has indicated that he wants to apply an action
on all buckets instead of the filtered ones.</p>
</dd>
<dt><strong><code>node</code></strong> :&ensp;<code>integer</code>, optional <code>None</code></dt>
<dd>
<p>If passed, it is a TF node, probably for a top-level section.
The effect is that it restricts the result to those buttons that fall
under that TF node.</p>
<p>We use this when we retrieve the context for a given bucket.</p>
</dd>
</dl></div>
</dd>
<dt id="tf.browser.ner.serve.Serve.setHandling"><code class="name flex">
<span>def <span class="ident">setHandling</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Carries out the set-related actions before composing the page.</p>
<p>These actions are:</p>
<ul>
<li>read the list of sets again</li>
<li>switch to an other set than the current set
and create it if it does not yet exist;</li>
<li>duplicate the current set;</li>
<li>rename the current set;</li>
<li>delete a set.</li>
</ul>
<p>The results of the actions are wrapped in messages and stored in the
<code>v</code>.</p></div>
</dd>
<dt id="tf.browser.ner.serve.Serve.setupFull"><code class="name flex">
<span>def <span class="ident">setupFull</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Prepares to serve a complete page.</p>
<ul>
<li>Sets up the find widget;</li>
<li>Encodes the active entity in hidden <code>input</code> elements;</li>
<li>Collects and generates the specific CSS styles needed for this corpus.</li>
</ul></div>
</dd>
<dt id="tf.browser.ner.serve.Serve.setupLean"><code class="name flex">
<span>def <span class="ident">setupLean</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Prepares to update a portion of the page.</p>
<ul>
<li>Encodes the active entity in hidden <code>input</code> elements.</li>
</ul></div>
</dd>
<dt id="tf.browser.ner.serve.Serve.updateHandling"><code class="name flex">
<span>def <span class="ident">updateHandling</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Carries out modification actions in the current annotation set.</p>
<p>Modification actions are:</p>
<ul>
<li>deletion of an entity;</li>
<li>addition of an entity.</li>
</ul>
<p>The results of the actions are wrapped in a report and stored in the
<code>v</code>.</p></div>
</dd>
<dt id="tf.browser.ner.serve.Serve.wrapFull"><code class="name flex">
<span>def <span class="ident">wrapFull</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Builds the full page.</p>
<p>This includes the controls by which the user makes selections and triggers
actions.</p></div>
</dd>
<dt id="tf.browser.ner.serve.Serve.wrapLean"><code class="name flex">
<span>def <span class="ident">wrapLean</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Builds a portion of the page.</p>
<p>No need to build user controls, because they are already on the page.</p>
<h2 id="returns">Returns</h2>
<p>The generated HTML for the portion of the page.</p></div>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="tf.browser.ner.request.Request" href="request.html#tf.browser.ner.request.Request">Request</a></b></code>:
<ul class="hlist">
<li><code><a title="tf.browser.ner.request.Request.adaptValSelect" href="request.html#tf.browser.ner.request.Request.adaptValSelect">adaptValSelect</a></code></li>
<li><code><a title="tf.browser.ner.request.Request.fget2" href="form.html#tf.browser.ner.form.Form.fget2">fget2</a></code></li>
<li><code><a title="tf.browser.ner.request.Request.fget3" href="form.html#tf.browser.ner.form.Form.fget3">fget3</a></code></li>
<li><code><a title="tf.browser.ner.request.Request.fgeti" href="form.html#tf.browser.ner.form.Form.fgeti">fgeti</a></code></li>
<li><code><a title="tf.browser.ner.request.Request.fgetj" href="form.html#tf.browser.ner.form.Form.fgetj">fgetj</a></code></li>
<li><code><a title="tf.browser.ner.request.Request.fgets" href="form.html#tf.browser.ner.form.Form.fgets">fgets</a></code></li>
<li><code><a title="tf.browser.ner.request.Request.fgetsi" href="form.html#tf.browser.ner.form.Form.fgetsi">fgetsi</a></code></li>
<li><code><a title="tf.browser.ner.request.Request.fgettu" href="form.html#tf.browser.ner.form.Form.fgettu">fgettu</a></code></li>
<li><code><a title="tf.browser.ner.request.Request.fill" href="form.html#tf.browser.ner.form.Form.fill">fill</a></code></li>
<li><code><a title="tf.browser.ner.request.Request.findSetup" href="request.html#tf.browser.ner.request.Request.findSetup">findSetup</a></code></li>
<li><code><a title="tf.browser.ner.request.Request.getFormData" href="request.html#tf.browser.ner.request.Request.getFormData">getFormData</a></code></li>
<li><code><a title="tf.browser.ner.request.Request.initVars" href="request.html#tf.browser.ner.request.Request.initVars">initVars</a></code></li>
</ul>
</li>
<li><code><b><a title="tf.browser.ner.fragments.Fragments" href="fragments.html#tf.browser.ner.fragments.Fragments">Fragments</a></b></code>:
<ul class="hlist">
<li><code><a title="tf.browser.ner.fragments.Fragments.wrapActive" href="fragments.html#tf.browser.ner.fragments.Fragments.wrapActive">wrapActive</a></code></li>
<li><code><a title="tf.browser.ner.fragments.Fragments.wrapAppearance" href="fragments.html#tf.browser.ner.fragments.Fragments.wrapAppearance">wrapAppearance</a></code></li>
<li><code><a title="tf.browser.ner.fragments.Fragments.wrapEntity" href="fragments.html#tf.browser.ner.fragments.Fragments.wrapEntity">wrapEntity</a></code></li>
<li><code><a title="tf.browser.ner.fragments.Fragments.wrapEntityFeats" href="fragments.html#tf.browser.ner.fragments.Fragments.wrapEntityFeats">wrapEntityFeats</a></code></li>
<li><code><a title="tf.browser.ner.fragments.Fragments.wrapEntityHeaders" href="fragments.html#tf.browser.ner.fragments.Fragments.wrapEntityHeaders">wrapEntityHeaders</a></code></li>
<li><code><a title="tf.browser.ner.fragments.Fragments.wrapEntityModReport" href="fragments.html#tf.browser.ner.fragments.Fragments.wrapEntityModReport">wrapEntityModReport</a></code></li>
<li><code><a title="tf.browser.ner.fragments.Fragments.wrapEntityModify" href="fragments.html#tf.browser.ner.fragments.Fragments.wrapEntityModify">wrapEntityModify</a></code></li>
<li><code><a title="tf.browser.ner.fragments.Fragments.wrapEntityStat" href="fragments.html#tf.browser.ner.fragments.Fragments.wrapEntityStat">wrapEntityStat</a></code></li>
<li><code><a title="tf.browser.ner.fragments.Fragments.wrapEntityText" href="fragments.html#tf.browser.ner.fragments.Fragments.wrapEntityText">wrapEntityText</a></code></li>
<li><code><a title="tf.browser.ner.fragments.Fragments.wrapExceptions" href="fragments.html#tf.browser.ner.fragments.Fragments.wrapExceptions">wrapExceptions</a></code></li>
<li><code><a title="tf.browser.ner.fragments.Fragments.wrapFilter" href="fragments.html#tf.browser.ner.fragments.Fragments.wrapFilter">wrapFilter</a></code></li>
<li><code><a title="tf.browser.ner.fragments.Fragments.wrapFindStat" href="fragments.html#tf.browser.ner.fragments.Fragments.wrapFindStat">wrapFindStat</a></code></li>
<li><code><a title="tf.browser.ner.fragments.Fragments.wrapMessages" href="fragments.html#tf.browser.ner.fragments.Fragments.wrapMessages">wrapMessages</a></code></li>
<li><code><a title="tf.browser.ner.fragments.Fragments.wrapQuery" href="fragments.html#tf.browser.ner.fragments.Fragments.wrapQuery">wrapQuery</a></code></li>
<li><code><a title="tf.browser.ner.fragments.Fragments.wrapReport" href="fragments.html#tf.browser.ner.fragments.Fragments.wrapReport">wrapReport</a></code></li>
<li><code><a title="tf.browser.ner.fragments.Fragments.wrapScope" href="fragments.html#tf.browser.ner.fragments.Fragments.wrapScope">wrapScope</a></code></li>
<li><code><a title="tf.browser.ner.fragments.Fragments.wrapSets" href="fragments.html#tf.browser.ner.fragments.Fragments.wrapSets">wrapSets</a></code></li>
</ul>
</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<p><a href="https://github.com/annotation" title="annotation on GitHub"><img src="../../../tf/images/tf-small.png" alt="annotation"></a></p>
<p><a href="../../../tf/index.html">tf home</a> -
<a href="../../../tf/cheatsheet.html">cheat sheet</a> -
<a href="https://github.com/annotation/text-fabric" title="GitHub repo"><img src="../../../tf/images/GitHub_Logo.png" alt="GitHub" width="50"></a></p>
</p>
<form>
<input id="lunr-search" name="q" placeholder="ðŸ”Ž Search ..." aria-label="Search"
disabled minlength="2">
</form>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.css" integrity="sha512-j1u8eUJ4f23xPPxwOrLUPQaCD2dwzNqqmDDcWS4deWsMv2ohLqmXXuP3hU7g8TyzbMSakP/mMqoNBYWj8AEIFg==" crossorigin>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.js" integrity="sha512-plGUER9JkeEWPPqQBE4sdLqBoQug5Ap+BCGMc7bJ8BXkm+VVj6QzkpBz5Yv2yPkkq+cqg9IpkBaGCas6uDbW8g==" crossorigin></script>
<style>
.modal-dialog iframe {
width: 100vw;
height: calc(100vh - 80px);
}
@media screen and (min-width: 700px) {
.modal-dialog iframe {
width: 70vw;
height: 80vh;
}
}
.modal-dialog .tingle-modal-box {width: auto;}
.modal-dialog .tingle-modal-box__content {padding: 0;}
</style>
<script>
const input = document.getElementById('lunr-search');
input.disabled = false;
input.form.addEventListener('submit', (ev) => {
ev.preventDefault();
const url = new URL(window.location);
url.searchParams.set('q', input.value);
history.replaceState({}, null, url.toString());
search(input.value);
});
const query = new URL(window.location).searchParams.get('q');
if (query)
search(query);
function search(query) {
const url = '../../../doc-search.html#' + encodeURIComponent(query);
new tingle.modal({
cssClass: ['modal-dialog'],
onClose: () => {
const url = new URL(window.location);
url.searchParams.delete('q');
history.replaceState({}, null, url.toString());
setTimeout(() => input.focus(), 100);
}
}).setContent('<iframe src="' + url + '"></iframe>').open();
}
</script>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="tf.browser.ner" href="index.html">tf.browser.ner</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="tf.browser.ner.serve.serveNer" href="#tf.browser.ner.serve.serveNer">serveNer</a></code></li>
<li><code><a title="tf.browser.ner.serve.serveNerContext" href="#tf.browser.ner.serve.serveNerContext">serveNerContext</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="tf.browser.ner.serve.Serve" href="#tf.browser.ner.serve.Serve">Serve</a></code></h4>
<ul class="two-column">
<li><code><a title="tf.browser.ner.serve.Serve.actionsFull" href="#tf.browser.ner.serve.Serve.actionsFull">actionsFull</a></code></li>
<li><code><a title="tf.browser.ner.serve.Serve.actionsLean" href="#tf.browser.ner.serve.Serve.actionsLean">actionsLean</a></code></li>
<li><code><a title="tf.browser.ner.serve.Serve.getBuckets" href="#tf.browser.ner.serve.Serve.getBuckets">getBuckets</a></code></li>
<li><code><a title="tf.browser.ner.serve.Serve.setHandling" href="#tf.browser.ner.serve.Serve.setHandling">setHandling</a></code></li>
<li><code><a title="tf.browser.ner.serve.Serve.setupFull" href="#tf.browser.ner.serve.Serve.setupFull">setupFull</a></code></li>
<li><code><a title="tf.browser.ner.serve.Serve.setupLean" href="#tf.browser.ner.serve.Serve.setupLean">setupLean</a></code></li>
<li><code><a title="tf.browser.ner.serve.Serve.updateHandling" href="#tf.browser.ner.serve.Serve.updateHandling">updateHandling</a></code></li>
<li><code><a title="tf.browser.ner.serve.Serve.wrapFull" href="#tf.browser.ner.serve.Serve.wrapFull">wrapFull</a></code></li>
<li><code><a title="tf.browser.ner.serve.Serve.wrapLean" href="#tf.browser.ner.serve.Serve.wrapLean">wrapLean</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<a href="https://pure.knaw.nl/portal/en/persons/dirk-roorda">Dirk Roorda</a>
<a href="https://huc.knaw.nl"><img alt="HuC" src="../../../tf/images/huc.png" width="200" alt="Humanities Cluster"></a>
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.11.1</a>.</p>
</footer>
</body>
</html>
